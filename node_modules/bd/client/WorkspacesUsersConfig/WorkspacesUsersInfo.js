/*
INPUT: 
  * workspaceId
  * userId
  * contactIdForSelect
DESCRIPTION
A widget to edit a record in the `WorkspacesUsersInfo` table, which extends 1:1 `workspacesUsers` (which comes from Hotplate and cannot be modified)
Note that the contact email address for workspace-related notifications is picked from the contact's email addresses for that workspace.
*/
define( [
  "dojo/_base/declare"

, "dijit/form/Form"
, "dijit/form/ValidationTextBox"
, "dijit/form/CheckBox"
, "hotplate/hotClientDojo/widgets/BusyButton"
, "hotplate/hotClientDojo/widgets/EditingWidget"

, "hotplate/bd/WorkspacesContacts/WorkspacesContactsEmailsSelect"


], function(

  declare

, Form
, ValidationTextBox
, CheckBox
, BusyButton

, EditingWidget

, WorkspacesContactsEmailsSelect

){

  return declare( [ EditingWidget ], {
    templateString: '' +
    '<div class="workspaces-users-info">\n'+
    '  <form data-dojo-type="dijit/form/Form" data-dojo-attach-point="formWidget" method="POST">\n'+
    '    <div class="box">\n'+
    '      <p class="boxTitle">Your settings</p>\n'+

    '      <div class="inputField">\n'+
    '        <label for="${id}_setting1">Setting 1</label>\n'+
    '        <input id="${id}_setting1" name="setting1" data-dojo-type="dijit/form/ValidationTextBox" data-dojo-attach-point="setting1Widget" size="40" maxlength="80", required:true" />\n'+
    '      </div>\n' +

    '      <div class="inputField">\n'+
    '        <label for="${id}_orderByNameDefault">Order contacts by name by default</label>\n'+
    '        <input id="${id}_orderByNameDefault" name="orderByNameDefault" data-dojo-type="dijit/form/CheckBox" data-dojo-attach-point="orderByNameDefault" size="40" maxlength="80", required:true" />\n'+
    '      </div>\n' +

    '      <div class="inputField">\n'+
    '        <label for="${id}_notificationsEmailAddress">Email address for system notifications</label>\n'+
    '        <div class="notificationsEmailAddress" id="${id}_notificationsEmailAddress" name="notificationsEmailAddress" data-dojo-type="hotplate/bd/WorkspacesContacts/WorkspacesContactsEmailsSelect" data-dojo-props="workspaceId: this.workspaceId, contactId: this.contactIdForSelect"></div>\n' +
    '      </div>\n' +

    '      <input class="formSubmit" type="submit" data-dojo-attach-point="buttonWidget" data-dojo-type="hotplate/hotClientDojo/widgets/BusyButton" label="Save" />\n'+
    '    </div>\n' +
    '  </form>\n' +
    '</div>\n' +
    '',

    storeName: 'workspacesUsersInfo',

    postMixInProperties: function(){
      this.inherited(arguments);

      this.storeParameters = { workspaceId: this.workspaceId };
      this.recordId = this.userId;
    },

    // Sets the boolean widget depending on value fetched
    afterFormWidgetSet: function( res ){
      if( res.orderByNameDefault ) this.orderByNameDefault.set('value', true );
    },

    manipulateValuesBeforeSubmit: function( values ){
      values.orderByNameDefault = values.orderByNameDefault.indexOf( 'on' ) !== -1;
    },


  });
});


