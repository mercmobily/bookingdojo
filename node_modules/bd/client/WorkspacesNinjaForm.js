
define([
  "dojo/_base/declare"

, "hotplate/hotDojoWidgets/widgets"

, "hotplate/bd/WorkspacesNinjaForm/WorkspacesNinjaFormSettings"
, "hotplate/bd/WorkspacesNinjaForm/WorkspacesNinjaFormCodes"
//, "hotplate/bd/WorkspacesNinjaForm/WorkspacesNinjaFormTimeOffset"
, "hotplate/bd/WorkspacesNinjaForm/WorkspacesNinjaFormStatus"
, "hotplate/bd/WorkspacesNinjaForm/WorkspacesNinjaFormIframeManager"
, "hotplate/bd/WorkspacesNinjaForm/WorkspacesNinjaFormLogBrowser"

, "hotplate/hotDojoGlobals/globals"
, "hotplate/hotDojoWidgets/BusyButton"

], function(
  declare

, widgets
, WorkspacesNinjaFormSettings
, WorkspacesNinjaFormCodes
//, WorkspacesNinjaFormTimeOffset
, WorkspacesNinjaFormStatus
, WorkspacesNinjaIframeManager
, WorkspacesNinjaFormLogBrowser

, globals
, BusyButton

){
  return declare( [ widgets.DestroyableTemplatedContainer ], {

    templateString: '' +
      '<div>\n' +

      '  <div class="box" id="ninja-settings" style="height:13em">\n'+
      '    <p class="boxTitle">Settaggi per Ninja Form</p>\n' +

      '    <div class="ninja-form-settings" style="display:inline-block" data-dojo-type="hotplate/bd/WorkspacesNinjaForm/WorkspacesNinjaFormSettings"></div>\n'+
      '      <div class="box" style="display:inline-block">\n'+
      '        <p class="boxTitle">Codici da mandare</p>\n' +
      '      <div class="ninja-form-codes" style="display:inline-block" data-dojo-type="hotplate/bd/WorkspacesNinjaForm/WorkspacesNinjaFormCodes"></div>\n'+
      '    </div>\n' +

/*
      '    <div class="box" style="display:inline-block; vertical-align: top">\n'+
      '      <p class="boxTitle">Sincronizzazione ora</p>\n' +
      '      <div class="ninja-form-time-offset" data-dojo-type="hotplate/bd/WorkspacesNinjaForm/WorkspacesNinjaFormTimeOffset"></div>\n'+
      '    </div>\n' +
*/


      '    <div class="box" style="display:inline-block; vertical-align: top">\n'+
      '      <p class="boxTitle">Stato</p>\n' +
      '      <div class="ninja-form-status" data-dojo-type="hotplate/bd/WorkspacesNinjaForm/WorkspacesNinjaFormStatus"></div>\n'+
      '    </div>\n' +
      '    <div class="ninja-form-download-logs" style="height: auto; display: block;" data-dojo-type="hotplate/hotDojoWidgets/BusyButton" data-dojo-attach-point="logsButton" label="Download i log"></div>\n'+


      '  </div>\n' +

      '  <div class="ninja-iframe-log-browser" id="ninja-iframe-log-browser" data-dojo-type="hotplate/bd/WorkspacesNinjaForm/WorkspacesNinjaFormLogBrowser" data-dojo-attach-point="logBrowser" data-dojo-props="queryOptions: { placeNew: \'first\' } , sort: [ { attribute: \'date\', descending: true} ]" style="height: 50%;" ></div>\n' +

      '  <div class="ninja-iframe-manager" id="ninja-iframe-manager" data-dojo-type="hotplate/bd/WorkspacesNinjaForm/WorkspacesNinjaFormIframeManager" data-dojo-attach-point="iframeManager" style="height: 98%;" ></div>\n' +

      '</div>\n' +
      '',


      postCreate: function(){
        this.inherited(arguments);

        this.logsButton.on( 'click', function( e ){
          window.open('/logs/' + globals.workspaceId );
        });        

      },
  });

});
