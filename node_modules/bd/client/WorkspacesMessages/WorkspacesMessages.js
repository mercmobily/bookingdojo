
define([
  "dojo/_base/declare"

, "dojo/on"
, "dijit/layout/TabContainer"
, "dijit/layout/ContentPane"

, "hotplate/hotDojoWidgets/widgets"
, "hotplate/hotDojoWidgets/Dummy"

, "hotplate/bd/WorkspacesMessages/WorkspacesMessagesPhoneNumbers"
, "hotplate/bd/WorkspacesMessages/WorkspacesMessagesEmail"

], function(
  declare

, on
, TabContainer
, ContentPane

, widgets
, Dummy
, WorkspacesMessagesPhoneNumbers
, WorkspacesMessagesEmail

){

  return declare( [ widgets.DestroyableTemplatedContainer ], {

    doLayout: false,

    templateString: '' +
      '<div class="workspaces-messages">\n' +
      '  <div class="workspaces-messages-tab" data-dojo-type="dijit/layout/TabContainer" data-dojo-props="doLayout: false" data-dojo-attach-point="tabsNode"></div>\n' +
      '</div>\n' +
      '',

    // Only the right tabs will come out, depending on the information available about the customer
    postCreate: function(){
      console.log("Contact object: ", this.parameter.contactObject );

      var self = this;
      var contactObject = self.parameter.contactObject;

      if( contactObject._children.mainPhoneNumberId ){

        var tab = new WorkspacesMessagesPhoneNumbers({ 
          title:'SMS', 
          storeName: this.storeName,
          storeParameters:this.storeParameters,
          contactObject: this.parameter.contactObject
        }, self.WorkspacesMessagesPhoneNumbersNode );
        self.tabsNode.addChild( tab );
        // Pass on the 'successfulsubmit' event, which will get the dialog closed
        tab.on(  'successfulsubmit', function( e ){
          on.emit( self.domNode, 'successfulsubmit', e );
        });

      }

      if( contactObject._children.mainEmailId ) {

        var tab = new WorkspacesMessagesEmail({ 
          title:'Email', 
          storeName: this.storeName,
          storeParameters:this.storeParameters,
          contactObject: this.parameter.contactObject          
        }, self.WorkspacesMessagesEmailNode );
        self.tabsNode.addChild( tab );
        // Pass on the 'successfulsubmit' event, which will get the dialog closed
        tab.on(  'successfulsubmit', function( e ){
          on.emit( self.domNode, 'successfulsubmit', e );
        });

      }

    }
  });

});
