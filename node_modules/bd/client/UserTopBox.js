/*
INPUT: 
* contactId -- the contactId associated to the user 
DESCRIPTION
A widget that will display the name of the contact, and -- when clicked on -- it will open up UsersConfig for that userId.
NOTE: It would make more logic sense to pass a userId to this widget. However, to get to the right WorkspacesContacts record, I would need to filter by userId -- something that ViewingWidget isn't able to do right now (it only accepts storeParameters and recordId).
TODO: A workaround would be a store that, given the userId, will return the contactId. This does imply an extra store, but it does make a lot of sense. I should definitely do that.
*/
define([
  "dojo/_base/declare"

, "dijit/Dialog"

, "hotplate/hotClientDojo/widgets/ViewingWidget"

, "hotplate/bd/UsersConfig"


], function(
  declare

, Dialog

, ViewingWidget

, UsersConfig

){

  return declare( [ ViewingWidget ], {

  	templateString: '' +
      '<span class="user-top-box">\n' +
      '  <span data-dojo-attach-point="nameNode" data-dojo-attach-event="ondijitclick:showUserConfig"></span>\n' +
      '</span>\n'+
      '',

   renderInfo: function(){
      this.nameNode.innerHTML = this.info.workspacesContacts.data.firstName;

      // The user-wide configuration dialog
      // This needs to happen after renderInfo as we only have the contacts' userId once
      // the record has been loaded
      this.userDialog = new Dialog( {
        title: "Your account",
        className: 'users-config',
      });
      this.userDialog.addChild( new UsersConfig({
        userId: this.info.workspacesContacts.data.userId
      }) );
      this.userDialog.startup();
    },

    postMixInProperties: function(){
      this.inherited(arguments);

      this.info = { 
        workspacesContacts: {
          id: this.contactId,
          storeParameters: { workspaceId: this.workspaceId }
        }
      };
    },
     
    showUserConfig: function(){
      this.userDialog.show();
    },

  });

});



