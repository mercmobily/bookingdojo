/* ***

Type: Templated Container
Input props:
  storeParameters: { workspaceId: [ workspaceId ] },
  contact: [full workspacesContacts record]
Description:
This widget is a templated container that will display various other widgets related to
the workspace contact (and its linked user, which is bound to a workspace).
* 

*** */
define([
  "dojo/_base/declare"
, "dojo/topic"

, "dijit/layout/ContentPane"

, "hotplate/hotClientDojo/widgets/widgets"

, "hotplate/hotClientDojo/stores/stores"
, "hotplate/hotClientDojo/storeConfig/ConfigVars"

, "hotplate/bd/WorkspacesUsersConfig/WorkspacesUsersInfo"
, "hotplate/bd/WorkspacesUsersConfig/WorkspacesUsersActivities"
, "hotplate/bd/WorkspacesContacts"
, "hotplate/hotClientDojo/widgets/ViewingWidget"

], function(
  declare
, topic

, ContentPane

, widgets

, stores
, ConfigVars

, WorkspacesUsersInfo
, WorkspacesUsersActivities
, WorkspacesContacts
, ViewingWidget

){

  return declare( [ ViewingWidget ], {

    templateString: '' +
      '<div class="workspaces-users-config">\n' +
      '  <div class="box">\n'+
      '    <p class="boxTitle">Contact information</p>\n' +
      '    <div id="workspaces-users-config-contact-editor" data-dojo-type="hotplate/bd/WorkspacesContacts" data-dojo-props="workspaceId: this.workspaceId, contactId: this.contactId"></div>\n' +
      '  </div>\n' +
      
      '  <span data-dojo-attach-point="mainEmailAddressNode"></span>\n' +
      
      '  <div data-dojo-type="hotplate/bd/WorkspacesUsersConfig/WorkspacesUsersInfo" data-dojo-props="workspaceId: this.workspaceId, userId: this.userId, contactIdForSelect: this.contactId"></div>\n' +

      '  <span class="config-heading">Activities for this workspace</span>\n' +
      '  <div class="small-editable-list" data-dojo-type="hotplate/bd/WorkspacesUsersConfig/WorkspacesUsersActivities" data-dojo-props="workspaceId: this.workspaceId, userId: this.userId"></div>\n'+
    
      '</div>\n' +
      '',

    postMixInProperties: function(){
      this.info = {
        workspacesContacts: { 
          id: this.contactId,
          storeParameters: { workspaceId: this.workspaceId }
        } 
      };
      this.inherited(arguments);

    },

    renderInfo: function(){
      var record = this.info.workspacesContacts.data;
      this.mainEmailAddressNode.innerHTML = record._children.mainEmailId ? record._children.mainEmailId.email : 'Not set';
    },

  });

});
