define([

  "dojo/_base/declare"
, "dojo/date/stamp"

, "dijit/form/Form"
, "dijit/form/ValidationTextBox"
, "dijit/form/DateTextBox"

, "hotplate/hotDojoStores/stores"
, "hotplate/hotDojoWidgets/BusyButton"
, "hotplate/hotDojoWidgets/EditingWidget"
, "hotplate/hotDojoGlobals/globals"

], function(

  declare
, stamp

, Form
, ValidationTextBox
, DateTextBox

, stores
, BusyButton
, EditingWidget
, globals

){


  console.log("STAMP IS:", stamp );
  STAMP = stamp;
  var UTCDateTextBox = declare( 'UTCDateTextBox', [ DateTextBox ], {


    _getValueAttr: function(){
      var ov = this.inherited(arguments);
      //console.log("GET Value before", ov );
      if( ov ){
        ov.setTime( ov.getTime() - ov.getTimezoneOffset() * 60 * 1000 ); 
      }
      //console.log("GET Value after:", ov );
      return ov;

    },

    _setValueAttr: function( value, priorityChange, formattedValue){


      //console.log("SET ISO value:", value );
      var v = stamp.fromISOString( value );
      //console.log("SET Value before:", v );
      if( v ){
        v.setTime( v.getTime() + v.getTimezoneOffset() * 60 * 1000 );  
        value = v;
      }
      //console.log("SET Value after:", v );
       
      this.inherited(arguments);
    },

 
  });

  return declare( [ EditingWidget ], {

    templateString: '' +
      '<div class="workspaces-contacts-info">\n' +
      '  <div class="box">\n'+
      '    <p class="boxTitle">Name</p>\n' +


      '    <form data-dojo-type="dijit/form/Form" data-dojo-attach-point="formWidget" method="POST">\n' +
      '      <div class="inputField name">\n' +
      '        <label for="${id}_firstName">Name</label>\n' +
      '        <input id="${id}_firstName" name="firstName" data-dojo-type="dijit/form/ValidationTextBox" size="25" maxlength="50" />\n' +
      '      </div>\n' +

      '      <div class="inputField middle-name">\n' +
      '        <label for="${id}_middleName">Middle Name</label>\n' +
      '        <input id="${id}_middleName" name="middleName" data-dojo-type="dijit/form/ValidationTextBox" size="10" maxlength="50" />\n' +
      '      </div>\n' +

      '      <div class="inputField last-name">\n' +
      '        <label for="${id}_lastName">Last Name</label>\n' +
      '        <input id="${id}_lastName" name="lastName" data-dojo-type="dijit/form/ValidationTextBox" size="10" maxlength="50" />\n' +
      '      </div>\n' +

      '      <div class="inputField date-of-birth">\n' +
      '        <label for="${id}_dateOfBirth">Date Of Birth</label>\n' +
      '        <input class="input" id="${id}_dateOfBirth" name="dateOfBirth" data-dojo-type="UTCDateTextBox" />\n' +
      '      </div>\n' +

      '      <input class="formSubmit" type="submit" data-dojo-attach-point="buttonWidget" data-dojo-type="hotplate/hotDojoWidgets/BusyButton" label="Save" />\n' +
      '    </form>\n' +
      '  </div>\n'+
      '</div>\n'+
      '',
  });
});


