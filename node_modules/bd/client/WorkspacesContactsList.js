
define([
  "dojo/_base/declare"

, "dijit/form/ValidationTextBox"

, "put-selector/put"

, "hotplate/hotDojoDgridWidgets/commonMixins"
, "hotplate/hotDojoWidgets/widgets"
, "hotplate/hotDojoWidgets/TempDialog"
, "hotplate/hotDojoWidgets/EditingWidget"
, "hotplate/hotDojoDgridWidgets/EditableList"
, "hotplate/hotDojoWidgets/BusyButton"
, "hotplate/hotDojoStores/stores"
, "hotplate/hotDojoGlobals/globals"


, "hotplate/bd/WorkspacesContacts"

], function(
  declare

, ValidationTextBox

, put

, commonMixins
, widgets
, TempDialog
, EditingWidget
, EditableList
, BusyButton
, stores
, globals

, WorkspacesContacts
){


  return declare( [ EditableList ], {

    refreshOnSubmit: true,
    immediateRefresh: false,

    ListConstructor: declare( [ commonMixins.FullOnDemandList ], {

      renderRow: function(object, options){
        var row = put('div.row', ( object.lastName ? object.lastName + ', ' : '' ) + object.firstName + ( object.middleName ? ' ' + object.middleName : '' ) );
        return row;
      },
      queryOptions: { placeNew: 'last' },
      dndParams: { selfAccept: false },
    }),

    EditingConstructor: WorkspacesContacts,
    AddingConstructor: WorkspacesContacts,

    ExtraWidgetConstructor: declare( [ widgets.DestroyableTemplatedContainer ], {
      templateString: '' +
        '<div>\n' +
        '  <div data-dojo-attach-point="buttonWidget" data-dojo-type="hotplate/hotDojoWidgets/BusyButton" label="New" />\n' +
        '</div>\n'+
        '',
    }),
    extraWidgetRegion: 'top',

    storeName: 'WorkspacesContacts',
    store: stores( 'WorkspacesContacts', { workspaceId: globals.workspaceId } ),
    editingWidgetPlacement: 'dialog',
    multipleEditingAllowed: false,
    //addingWidgetRegion: 'top',
    gutters: false,

    buttonsPosition: 'after', // or "top" or "bottom"

    postCreate: function(){

      this.inherited(arguments);
      var self = this;

      self.extraWidget.buttonWidget.on( 'click', function( e ){
        self.addingConstructorInDialog( 'New contact' );
      });

   },


  } );

});


